<!-- Reusable Modal Components for Mitch Quick -->

<!-- Generic Confirmation Modal -->
<div class="modal fade" id="confirmModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="confirmModalTitle">Confirm Action</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body" id="confirmModalBody">
                Are you sure you want to proceed?
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                <button type="button" class="btn btn-danger" id="confirmModalAction">Confirm</button>
            </div>
        </div>
    </div>
</div>

<!-- Item Quick View Modal -->
<div class="modal fade" id="itemQuickViewModal" tabindex="-1">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="itemQuickViewTitle">Item Details</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body" id="itemQuickViewBody">
                <div class="text-center">
                    <div class="spinner-border" role="status">
                        <span class="visually-hidden">Loading...</span>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                <a href="#" class="btn btn-primary" id="itemQuickViewEdit">
                    <i class="fas fa-edit me-1"></i>Edit Item
                </a>
            </div>
        </div>
    </div>
</div>

<!-- Partner Share Calculator Modal -->
<div class="modal fade" id="partnerShareModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Partner Share Calculator</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <form id="partnerShareForm">
                    <div class="mb-3">
                        <label for="shareNetProfit" class="form-label">Net Profit</label>
                        <div class="input-group">
                            <span class="input-group-text">$</span>
                            <input type="number" class="form-control" id="shareNetProfit" step="0.01" readonly>
                        </div>
                    </div>
                    <div class="mb-3">
                        <label for="sharePercentage" class="form-label">Partner Share Percentage</label>
                        <div class="input-group">
                            <input type="number" class="form-control" id="sharePercentage" min="0" max="100" step="0.1">
                            <span class="input-group-text">%</span>
                        </div>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Partner Earnings</label>
                        <div class="input-group">
                            <span class="input-group-text">$</span>
                            <input type="text" class="form-control" id="partnerEarnings" readonly>
                        </div>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
            </div>
        </div>
    </div>
</div>

<!-- Bulk Action Modal -->
<div class="modal fade" id="bulkActionModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Bulk Actions</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <div class="mb-3">
                    <label class="form-label">Selected Items: <span id="bulkSelectedCount">0</span></label>
                </div>
                <div class="mb-3">
                    <label for="bulkAction" class="form-label">Action</label>
                    <select class="form-select" id="bulkAction">
                        <option value="">Select an action...</option>
                        <option value="updateStatus">Update Status</option>
                        <option value="updatePrices">Update eBay Prices</option>
                        <option value="export">Export Selected</option>
                        <option value="delete">Delete Selected</option>
                    </select>
                </div>
                <div class="mb-3" id="bulkStatusOptions" style="display: none;">
                    <label for="bulkNewStatus" class="form-label">New Status</label>
                    <select class="form-select" id="bulkNewStatus">
                        <option value="watch">Watchlist</option>
                        <option value="won">Won/Inventory</option>
                        <option value="listed">Listed for Sale</option>
                        <option value="sold">Sold</option>
                    </select>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                <button type="button" class="btn btn-primary" id="executeBulkAction">Execute Action</button>
            </div>
        </div>
    </div>
</div>

<!-- ROI Calculator Modal -->
<div class="modal fade" id="roiCalculatorModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">
                    <i class="fas fa-calculator me-2"></i>ROI Calculator
                </h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <form id="roiCalculatorForm">
                    <div class="mb-3">
                        <label for="roiPurchasePrice" class="form-label">Purchase Price</label>
                        <div class="input-group">
                            <span class="input-group-text">$</span>
                            <input type="number" class="form-control" id="roiPurchasePrice" step="0.01">
                        </div>
                    </div>
                    <div class="mb-3">
                        <label for="roiRefurbCost" class="form-label">Refurbishment Cost</label>
                        <div class="input-group">
                            <span class="input-group-text">$</span>
                            <input type="number" class="form-control" id="roiRefurbCost" step="0.01" value="0">
                        </div>
                    </div>
                    <div class="mb-3">
                        <label for="roiSalePrice" class="form-label">Sale Price</label>
                        <div class="input-group">
                            <span class="input-group-text">$</span>
                            <input type="number" class="form-control" id="roiSalePrice" step="0.01">
                        </div>
                    </div>
                    <div class="mb-3">
                        <label for="roiSaleFees" class="form-label">Sale Fees</label>
                        <div class="input-group">
                            <span class="input-group-text">$</span>
                            <input type="number" class="form-control" id="roiSaleFees" step="0.01" value="0">
                        </div>
                    </div>
                    <div class="mb-3">
                        <label for="roiShippingCost" class="form-label">Shipping Cost</label>
                        <div class="input-group">
                            <span class="input-group-text">$</span>
                            <input type="number" class="form-control" id="roiShippingCost" step="0.01" value="0">
                        </div>
                    </div>
                    <hr>
                    <div class="row text-center">
                        <div class="col-4">
                            <h5 id="roiGrossProfit" class="text-primary">$0.00</h5>
                            <small class="text-muted">Gross Profit</small>
                        </div>
                        <div class="col-4">
                            <h5 id="roiNetProfit" class="text-success">$0.00</h5>
                            <small class="text-muted">Net Profit</small>
                        </div>
                        <div class="col-4">
                            <h5 id="roiPercentage" class="text-info">0.0%</h5>
                            <small class="text-muted">ROI</small>
                        </div>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                <button type="button" class="btn btn-primary" onclick="resetROICalculator()">Reset</button>
            </div>
        </div>
    </div>
</div>

<!-- Loading Modal -->
<div class="modal fade" id="loadingModal" tabindex="-1" data-bs-backdrop="static" data-bs-keyboard="false">
    <div class="modal-dialog modal-sm">
        <div class="modal-content">
            <div class="modal-body text-center py-4">
                <div class="spinner-border text-primary mb-3" role="status">
                    <span class="visually-hidden">Loading...</span>
                </div>
                <h6 id="loadingMessage">Processing...</h6>
                <small class="text-muted" id="loadingSubMessage">Please wait</small>
            </div>
        </div>
    </div>
</div>

<!-- Email Report Modal -->
<div class="modal fade" id="emailReportModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">
                    <i class="fas fa-envelope me-2"></i>Email Report
                </h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <form id="emailReportForm">
                    <div class="mb-3">
                        <label for="emailRecipients" class="form-label">Recipients</label>
                        <textarea class="form-control" id="emailRecipients" rows="3" 
                                  placeholder="Enter email addresses (one per line or comma-separated)"></textarea>
                        <div class="form-text">Separate multiple emails with commas or line breaks</div>
                    </div>
                    <div class="mb-3">
                        <label for="emailReportType" class="form-label">Report Type</label>
                        <select class="form-select" id="emailReportType">
                            <option value="weekly">Weekly Cash Flow</option>
                            <option value="profit">Profit Analysis</option>
                            <option value="partner">Partner Earnings</option>
                            <option value="custom">Custom Report</option>
                        </select>
                    </div>
                    <div class="mb-3">
                        <label for="emailSubject" class="form-label">Subject</label>
                        <input type="text" class="form-control" id="emailSubject" 
                               value="Mitch Quick - Weekly Report">
                    </div>
                    <div class="mb-3">
                        <label for="emailMessage" class="form-label">Additional Message</label>
                        <textarea class="form-control" id="emailMessage" rows="3" 
                                  placeholder="Optional message to include with the report"></textarea>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                <button type="button" class="btn btn-primary" id="sendEmailReport">
                    <i class="fas fa-paper-plane me-1"></i>Send Report
                </button>
            </div>
        </div>
    </div>
</div>

<script>
// Modal utility functions
window.ModalUtils = {
    // Show confirmation modal
    showConfirmation: function(title, message, actionText, actionClass, callback) {
        document.getElementById('confirmModalTitle').textContent = title;
        document.getElementById('confirmModalBody').textContent = message;
        const actionBtn = document.getElementById('confirmModalAction');
        actionBtn.textContent = actionText;
        actionBtn.className = `btn ${actionClass}`;
        actionBtn.onclick = callback;
        new bootstrap.Modal(document.getElementById('confirmModal')).show();
    },

    // Show loading modal
    showLoading: function(message, subMessage) {
        document.getElementById('loadingMessage').textContent = message || 'Processing...';
        document.getElementById('loadingSubMessage').textContent = subMessage || 'Please wait';
        new bootstrap.Modal(document.getElementById('loadingModal')).show();
    },

    // Hide loading modal
    hideLoading: function() {
        const modal = bootstrap.Modal.getInstance(document.getElementById('loadingModal'));
        if (modal) modal.hide();
    },

    // Show partner share calculator
    showPartnerShareCalculator: function(netProfit, percentage) {
        document.getElementById('shareNetProfit').value = netProfit || 0;
        document.getElementById('sharePercentage').value = percentage || 0;
        this.calculatePartnerShare();
        new bootstrap.Modal(document.getElementById('partnerShareModal')).show();
    },

    // Calculate partner share
    calculatePartnerShare: function() {
        const netProfit = parseFloat(document.getElementById('shareNetProfit').value) || 0;
        const percentage = parseFloat(document.getElementById('sharePercentage').value) || 0;
        const earnings = (netProfit * percentage) / 100;
        document.getElementById('partnerEarnings').value = earnings.toFixed(2);
    },

    // Show ROI calculator
    showROICalculator: function() {
        new bootstrap.Modal(document.getElementById('roiCalculatorModal')).show();
    }
};

// Partner share calculator event listeners
document.getElementById('sharePercentage').addEventListener('input', function() {
    ModalUtils.calculatePartnerShare();
});

// ROI calculator event listeners
document.querySelectorAll('#roiCalculatorForm input').forEach(input => {
    input.addEventListener('input', calculateROI);
});

function calculateROI() {
    const purchasePrice = parseFloat(document.getElementById('roiPurchasePrice').value) || 0;
    const refurbCost = parseFloat(document.getElementById('roiRefurbCost').value) || 0;
    const salePrice = parseFloat(document.getElementById('roiSalePrice').value) || 0;
    const saleFees = parseFloat(document.getElementById('roiSaleFees').value) || 0;
    const shippingCost = parseFloat(document.getElementById('roiShippingCost').value) || 0;

    const grossProfit = salePrice - purchasePrice - refurbCost;
    const netProfit = grossProfit - saleFees - shippingCost;
    const totalInvestment = purchasePrice + refurbCost;
    const roiPercentage = totalInvestment > 0 ? (netProfit / totalInvestment) * 100 : 0;

    document.getElementById('roiGrossProfit').textContent = '$' + grossProfit.toFixed(2);
    document.getElementById('roiGrossProfit').className = grossProfit >= 0 ? 'text-success' : 'text-danger';
    
    document.getElementById('roiNetProfit').textContent = '$' + netProfit.toFixed(2);
    document.getElementById('roiNetProfit').className = netProfit >= 0 ? 'text-success' : 'text-danger';
    
    document.getElementById('roiPercentage').textContent = roiPercentage.toFixed(1) + '%';
    document.getElementById('roiPercentage').className = roiPercentage >= 0 ? 'text-success' : 'text-danger';
}

function resetROICalculator() {
    document.getElementById('roiCalculatorForm').reset();
    calculateROI();
}

// Bulk action modal
document.getElementById('bulkAction').addEventListener('change', function() {
    const statusOptions = document.getElementById('bulkStatusOptions');
    statusOptions.style.display = this.value === 'updateStatus' ? 'block' : 'none';
});
</script>
